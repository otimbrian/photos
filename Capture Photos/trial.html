<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div>
        <!-- <img src="" alt="" class="img">
        <video src="" class="video"></video>
        <button type="submit">Get Video</button> -->
        <div>
            <video autoplay=""></video>
            <button id="getUserMediaButton">Get User Media</button>
        </div>
        <div>
            <canvas id="grabFrameCanvas"></canvas>
            <button id="grabFrameButton" disabled="">Grab Frame</button>
        </div>
        <div>
            <canvas id="takePhotoCanvas"></canvas>
            <button id="takePhotoButton" disabled="">Take Photo</button>
        </div>
    </div>


</body>

<footer>

    <script>

        //The video stream before taking the photo.
        function onGetUserMediaButtonClick() {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(mediaStream => {
                    document.querySelector('video').srcObject = mediaStream;

                    const track = mediaStream.getVideoTracks()[0];
                    imageCapture = new ImageCapture(track);
                })
                .catch(error => ChromeSamples.log(error));
        }
        //Take photo Useing the grabFrame Function.

        function onGrabFrameButtonClick() {
            imageCapture.grabFrame()
                .then(imageBitmap => {
                    const canvas = document.querySelector('#grabFrameCanvas');
                    drawCanvas(canvas, imageBitmap);
                })
                .catch(error => ChromeSamples.log(error));
        }


        //Take photo using the image capture Methos.
        function onTakePhotoButtonClick() {
            imageCapture.takePhoto()
                .then(blob => createImageBitmap(blob))
                .then(imageBitmap => {
                    const canvas = document.querySelector('#takePhotoCanvas');
                    drawCanvas(canvas, imageBitmap);
                })
                .catch(error => ChromeSamples.log(error));
        }

        //My completed code.

        const takePhoto = () => {
            const img = document.querySelector('.img');
            try {
                navigator.mediaDevices.getUserMedia(
                    { video: true }
                ).then(
                    mediaStream => {
                        try {
                            const mediaStreamTrack = mediaStream.getVideoTracks()[0]
                            const imageCapture = new ImageCapture(mediaStreamTrack)

                            imageCapture.takePhoto().then(
                                blob => {
                                    img.src = URL.createObjectURL(blob)
                                    img.onload = () => { URL.revokeObjectURL(this.src); }
                                }
                            ).catch(
                                err => {
                                    console.log("Image Capture Error", err)
                                }
                            )
                        } catch (error) {
                            console.log("Error getting vid", error)
                        }
                    }
                )
            } catch {
                err => {
                    console.log("Error in getting media devices", err)
                }
            }
        }

        document.querySelector('video').addEventListener('play', function () {
            document.querySelector('#grabFrameButton').disabled = false;
            document.querySelector('#takePhotoButton').disabled = false;
        });
    </script>
</footer>

</html>